<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Australian Bushfire Alert System</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <div class="logo-title">
      <a href="/">
        <img src="assets/logo.jpg" alt="Logo" width="60" height="60">
      </a>
      <h1>Australian Bushfire Alert System</h1>
    </div>
    <nav>
  <a href="index.html" class="active">Dashboard</a>
  <a href="roster.html">Roster</a>
  <a href="vehicle.html">Vehicle Tracking</a>
  <a href="about.html">About</a>
    </nav>
  </header>
  <main>
    <div class="dashboard-flex">
      <section class="alerts-list-section">
        <div class="alerts-header">
          <h2>Active Alerts</h2>
        </div>
        <div id="alertsList" class="alerts-list"></div>
      </section>
      <div class="map-medical-stack">
        <section class="map-section">
          <h2>Current Bushfire Alerts</h2>
          <div id="map" class="map-embed"></div>
        </section>
        <section class="medical-emergency-section card">
          <h2>Medical Emergency Integrations</h2>
          <div id="med-integration-tabs" class="med-tabs">
            <button onclick="showMedIntegration(0)">Dispatch Coordination</button>
            <button onclick="showMedIntegration(1)">Health Risk Mapping</button>
            <button onclick="showMedIntegration(2)">Responder Profiles</button>
            <button onclick="showMedIntegration(3)">Health Services</button>
            <button onclick="showMedIntegration(4)">Equipment Tracking</button>
            <button onclick="showMedIntegration(5)">Predictive Alerts</button>
            <button onclick="showMedIntegration(6)">Incident Analytics</button>
          </div>
          <div id="med-integration-content" class="med-content">
            <!-- Details will appear here -->
          </div>
        </section>
      </div>
    </div>
  </main>
  <footer>
    <p>Based on AFDRS and the <a href="https://www.australianwarningsystem.com.au/" target="_blank">Australian Warning System</a>. Not for operational use.</p>
  </footer>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="script.js"></script>
  <script>
    // --- Bushfire.io Live Incidents Overlay ---
    // Fetches and displays live bushfire incidents from bushfire.io
    function addBushfireIoIncidents() {
      if (!window.L || !window.map) return;
      fetch('https://api.bushfire.io/incidents')
        .then(r => r.json())
        .then(data => {
          if (!Array.isArray(data)) return;
          data.forEach(incident => {
            if (!incident.location || !incident.location.lat || !incident.location.lng) return;
            const lat = incident.location.lat;
            const lng = incident.location.lng;
            const icon = L.icon({
              iconUrl: 'assets/icon-bushfire.svg',
              iconSize: [36, 36],
              iconAnchor: [18, 36],
              popupAnchor: [0, -30],
            });
            const popup = `<b>${incident.title || 'Bushfire Incident'}</b><br>
              <b>Status:</b> ${incident.status || 'Unknown'}<br>
              <b>Location:</b> ${incident.locationDesc || ''}<br>
              <b>Updated:</b> ${incident.updated ? new Date(incident.updated).toLocaleString() : ''}`;
            L.marker([lat, lng], { icon }).addTo(window.map).bindPopup(popup);
          });
        });
    }
    // Wait for map to be ready
    (function waitForBushfireIo() {
      if (window.L && window.map) { addBushfireIoIncidents(); }
      else setTimeout(waitForBushfireIo, 400);
    })();
  </script>
  <script>
    // --- Weather & Wind Overlay for Major Australian Cities ---
    // Uses Open-Meteo free API (no key required)
    const majorCities = [
      { name: 'Sydney', coords: [-33.8688, 151.2093] },
      { name: 'Melbourne', coords: [-37.8136, 144.9631] },
      { name: 'Brisbane', coords: [-27.4698, 153.0251] },
      { name: 'Perth', coords: [-31.9505, 115.8605] },
      { name: 'Adelaide', coords: [-34.9285, 138.6007] },
      { name: 'Canberra', coords: [-35.2809, 149.1300] },
      { name: 'Hobart', coords: [-42.8821, 147.3272] },
      { name: 'Darwin', coords: [-12.4634, 130.8456] },
      { name: 'Alice Springs', coords: [-23.6980, 133.8807] },
      { name: 'Cairns', coords: [-16.9203, 145.7703] }
    ];
    // Weather code to icon mapping (Open-Meteo standard)
    const weatherIcons = {
      0: '‚òÄÔ∏è', // Clear
      1: 'üå§Ô∏è', 2: '‚õÖ', 3: '‚òÅÔ∏è', // Mainly clear, partly cloudy, overcast
      45: 'üå´Ô∏è', 48: 'üå´Ô∏è', // Fog
      51: 'üå¶Ô∏è', 53: 'üå¶Ô∏è', 55: 'üå¶Ô∏è', // Drizzle
      61: 'üåßÔ∏è', 63: 'üåßÔ∏è', 65: 'üåßÔ∏è', // Rain
      71: 'üå®Ô∏è', 73: 'üå®Ô∏è', 75: 'üå®Ô∏è', // Snow
      80: 'üå¶Ô∏è', 81: 'üå¶Ô∏è', 82: 'üå¶Ô∏è', // Showers
      95: '‚õàÔ∏è', 96: '‚õàÔ∏è', 99: '‚õàÔ∏è' // Thunderstorm
    };
    function getWeatherIcon(code) {
      return weatherIcons[code] || '‚ùì';
    }
    function getWindArrow(deg) {
      // Unicode arrow, rotate with CSS
      return `<span style="display:inline-block;transform:rotate(${deg}deg);font-size:1.5em;">‚û§</span>`;
    }
    function addWeatherToMap() {
      if (!window.L || !window.map) return;
      majorCities.forEach(city => {
        fetch(`https://api.open-meteo.com/v1/forecast?latitude=${city.coords[0]}&longitude=${city.coords[1]}&current_weather=true`)
          .then(r => r.json())
          .then(data => {
            if (!data.current_weather) return;
            const icon = getWeatherIcon(data.current_weather.weathercode);
            const temp = Math.round(data.current_weather.temperature);
            const windSpeed = Math.round(data.current_weather.windspeed);
            const windDir = Math.round(data.current_weather.winddirection);
            // Draw multiple dashed lines to simulate wind
            const numLines = 5;
            const spread = 18; // degrees, total spread
            const length = 0.18 + 0.01 * windSpeed; // degrees, proportional to speed
            const lat1 = city.coords[0];
            const lon1 = city.coords[1];
            for (let i = 0; i < numLines; i++) {
              const offset = (i - (numLines - 1) / 2) * (spread / (numLines - 1));
              const dir = windDir + offset;
              const rad = (dir - 90) * Math.PI / 180;
              const lat2 = lat1 + length * Math.sin(rad);
              const lon2 = lon1 + length * Math.cos(rad);
              L.polyline([[lat1, lon1], [lat2, lon2]], {
                color: '#1976d2',
                weight: 2,
                dashArray: '6, 8',
                opacity: 0.7
              }).addTo(window.map);
            }
            // Weather/City marker
            const windArrow = getWindArrow(windDir);
            const marker = L.marker(city.coords, {
              icon: L.divIcon({
                className: 'weather-city-icon',
                html: `<div style=\"font-size:2em;line-height:1;\">${icon}</div><div style=\"font-size:1em;font-weight:bold;\">${temp}&deg;C</div><div style=\"font-size:1em;\">${windArrow} <span style='font-size:0.95em;'>${windSpeed} km/h</span></div><div style=\"font-size:0.9em;\">${city.name}</div>`,
                iconAnchor: [20, 48]
              })
            }).addTo(window.map);
            marker.bindPopup(`<b>${city.name}</b><br>Weather: ${icon} ${temp}&deg;C<br>Wind: ${windArrow} ${windSpeed} km/h (${windDir}&deg;)`);
          });
      });
    }
    // Wait for map to be ready
    function addBushfireIoIncidents() {
      if (!window.L || !window.map) return;
      fetch('/api/bushfireio')
        .then(r => r.json())
        .then(data => {
          if (!Array.isArray(data)) return;
          data.forEach(incident => {
            if (!incident.location || !incident.location.lat || !incident.location.lng) return;
            const lat = incident.location.lat;
            const lng = incident.location.lng;
            const icon = L.icon({
              iconUrl: 'assets/icon-bushfire.svg',
              iconSize: [36, 36],
              iconAnchor: [18, 36],
              popupAnchor: [0, -30],
            });
            const popup = `<b>${incident.title || 'Bushfire Incident'}</b><br>` +
              `<b>Status:</b> ${incident.status || 'Unknown'}<br>` +
              `<b>Location:</b> ${incident.locationDesc || ''}<br>` +
              `<b>Updated:</b> ${incident.updated ? new Date(incident.updated).toLocaleString() : ''}`;
            L.marker([lat, lng], { icon }).addTo(window.map).bindPopup(popup);
          });
        })
        .catch(err => {
          console.error('Failed to fetch bushfire incidents:', err);
        });
    }
    (function waitForMap() {
      if (window.L && window.map) {
        addWeatherToMap();
        addBushfireIoIncidents();
      } else setTimeout(waitForMap, 400);
    })();
  </script>
  <script>
    // Collapsible alerts section
    const alertsSection = document.querySelector('.alerts-list-section');
    const toggleBtn = document.getElementById('toggle-alerts');
    if (alertsSection && toggleBtn) {
      toggleBtn.addEventListener('click', () => {
        alertsSection.classList.toggle('collapsed');
      });
    }
  </script>
  <script>
    // Medical Integration Dashboard Interactivity
    const medIntegrationDetails = [
      `<strong>Real-Time Medical Dispatch Coordination:</strong><br>
      Integrate with ambulance dispatch systems for coordinated fire and medical response.<br>
      Enable dual-response alerts for incidents involving injury, smoke inhalation, or burns.`,
      `<strong>Health Risk Mapping:</strong><br>
      Overlay vulnerable population data (aged care, hospitals, disability services) on bushfire prediction maps.<br>
      Prioritize evacuation and medical support based on risk zones.`,
      `<strong>First Responder Medical Profiles:</strong><br>
      Include paramedic certifications and first aid skills in the roster system.<br>
      Auto-assign medically trained firefighters to incidents with injury potential.`,
      `<strong>Integration with Emergency Health Services:</strong><br>
      Connect with state health databases to access nearest trauma centers, air ambulance availability, and real-time hospital capacity.`,
      `<strong>Medical Equipment Tracking:</strong><br>
      Link inventory systems to track medical kits, oxygen tanks, and burn treatment supplies on each fire vehicle.<br>
      Alert roster managers when equipment is low or expired.`,
      `<strong>Predictive Health Alerts:</strong><br>
      Use bushfire simulation data to forecast smoke exposure zones.<br>
      Trigger alerts for respiratory risk and deploy medical teams proactively.`,
      `<strong>Incident Reporting and Analytics:</strong><br>
      Add modules for medical incident logging during bushfire events.<br>
      Analyze trends in injuries, response times, and treatment outcomes.`
    ];
    function showMedIntegration(idx) {
      document.getElementById('med-integration-content').innerHTML = medIntegrationDetails[idx];
      // Highlight active tab
      const btns = document.querySelectorAll('.med-tabs button');
      btns.forEach((btn, i) => btn.classList.toggle('active', i === idx));
    }
    // Show first tab by default
    showMedIntegration(0);
  </script>
</body>
</html>
