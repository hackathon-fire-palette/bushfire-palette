<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Kimberley WA — Live Fire Simulation</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body { margin:0; padding:0; display:flex; height:100vh; }
    #controls { width:300px; background:#fff; padding:10px; overflow:auto; font-family:Arial, sans-serif; }
    #map { flex:1; }
    table { width:100%; border-collapse:collapse; font-size:12px; margin-top:10px; }
    th, td { border:1px solid #ccc; padding:4px; text-align:center; }
  </style>
</head>
<body>
<div id="controls">
  <h3>Kimberley WA — Live Fire Simulation</h3>

  <label>Humidity (%) <input type="range" id="humidity" min="0" max="100" value="20"></label><br>
  <label>Temperature (°C) <input type="range" id="temperature" min="10" max="50" value="38"></label><br>
  <label>Wind Speed (km/h) <input type="range" id="windSpeed" min="0" max="100" value="25"></label><br>
  <label>Wind Dir (° from North) <input type="range" id="windDir" min="0" max="360" value="90"></label><br>
  <label>Fuel Load (%) <input type="range" id="fuel" min="0" max="100" value="70"></label><br>
  <label>Aggression (0–100) <input type="range" id="aggression" min="0" max="100" value="40"></label><br>

  <h4>Time Horizons (hours)</h4>
  <label><input type="checkbox" class="horizon" value="1" checked> 1h</label><br>
  <label><input type="checkbox" class="horizon" value="2" checked> 2h</label><br>
  <label><input type="checkbox" class="horizon" value="3" checked> 3h</label><br>
  <label><input type="checkbox" class="horizon" value="5" checked> 5h</label><br>
  <label><input type="checkbox" class="horizon" value="8" checked> 8h</label><br>

  <button id="play">Play</button>
  <button id="pause">Pause</button>
  <button id="step">Step</button>
  <button id="reset">Reset</button>

  <h4>Simulation Results</h4>
  <table id="results">
    <tr><th>Color</th><th>ETA</th><th>Acres</th><th>Population</th><th>Housing</th></tr>
  </table>
</div>
<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([-17.9614, 122.2300], 11); // Broome, Kimberley WA
  L.tileLayer('https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}', {
    subdomains:['mt0','mt1','mt2','mt3']
  }).addTo(map);

  let ignition = L.marker([-17.9614, 122.2300], {draggable:true}).addTo(map);

  const colors = ['#ffff66','#ffcc33','#ff6600','#cc0000','#660000'];
  const horizons = [1,2,3,5,8];
  let layerGroup = L.layerGroup().addTo(map);

  let playing = false, stepIndex=0, timer;

  function acresFromRadius(r) {
    return Math.round(Math.PI * (r/1000)**2 * 0.247); // dummy acres
  }

  function updateTable(hour, color, radius) {
    const row = `<tr>
      <td style="background:${color}"></td>
      <td>${hour}h</td>
      <td>${acresFromRadius(radius)}</td>
      <td>${Math.round(radius*2)}</td>
      <td>${Math.round(radius)}</td>
    </tr>`;
    document.getElementById('results').insertAdjacentHTML('beforeend', row);
  }

  function drawPolygon(hour, color) {
    const center = ignition.getLatLng();
    const radius = hour * 5000; // 5 km per hour, exaggerated for visibility
    const points = [];
    for (let a=0; a<360; a+=10) {
      const angle = (a-90) * Math.PI/180;
      const dx = radius * Math.cos(angle);
      const dy = radius * Math.sin(angle);
      const lat = center.lat + (dy/111320);
      const lng = center.lng + (dx/(111320*Math.cos(center.lat*Math.PI/180)));
      points.push([lat,lng]);
    }
    const poly = L.polygon(points, {color:'black', weight:1, fillColor:color, fillOpacity:0.6});
    poly.addTo(layerGroup);
    console.log(`Drawn ${hour}h polygon, radius=${radius}m, center=`, center);
    updateTable(hour, color, radius);
  }

  function step() {
    if (stepIndex >= horizons.length) return;
    drawPolygon(horizons[stepIndex], colors[stepIndex]);
    stepIndex++;
  }

  document.getElementById('play').onclick = () => {
    playing=true;
    timer=setInterval(step,1500);
  };
  document.getElementById('pause').onclick = () => { playing=false; clearInterval(timer); };
  document.getElementById('step').onclick = step;
  document.getElementById('reset').onclick = () => {
    layerGroup.clearLayers();
    document.getElementById('results').innerHTML='<tr><th>Color</th><th>ETA</th><th>Acres</th><th>Population</th><th>Housing</th></tr>';
    stepIndex=0; clearInterval(timer); playing=false;
  };
</script>
</body>
</html>
